<?php


?>

<div class="d-flex justify-content-start align-items-center bg-white-0-5 border-radius-10 p-1 m-1 w-100 flex-column">
    <div class="d-flex justify-content-center bg-dark w-100 px-2 py-1 d-flex text-center border-radius-5 text-white text-xl font-bold">Campaign Overview</div>
    <div class="d-flex flex-wrap flex-center bg-white-0-3 w-100 gap-1 p-2 border-radius-5">
        <div class="d-flex flex-column bg-white text-white border-dark border-radius-5"
             style="width: 250px;height: 180px">
            <div class="d-flex flex-column flex-center gap-0-5 h-100">
                <div class="font-bold text-xl">Donors in Queue</div>
                <div class="single-chart">
                    <svg viewBox="0 0 36 36" class="circular-chart purple">
                        <path class="circle-bg"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <path class="circle"
                              stroke-dasharray="40, 100"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <text x="18" y="20.35" class="percentage">60%</text>
                    </svg>
                </div>
                <div><span class="font-extraBold text-purple-8 text-xl">60</span> / <span>100</span></div>
            </div>
            <div class="w-100 bg-purple-8 border-radius-5 align-self-center"
                 style="height: 5px;margin-bottom: 2px;width: 100%">

            </div>
        </div>
        <div class="d-flex flex-column bg-white text-white border-dark border-radius-5"
             style="width: 250px;height: 180px">
            <div class="d-flex flex-column flex-center gap-0-5 h-100">
                <div class="d-flex flex-column font-bold text-xl">
                    Registered Donors
                </div>

                <div class="single-chart">
                    <svg viewBox="0 0 36 36" class="circular-chart dark">
                        <path class="circle-bg"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <path class="circle"
                              stroke-dasharray="30, 100"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <text x="18" y="20.35" class="percentage">30%</text>
                    </svg>
                </div>
                <div><span class="font-extraBold text-dark text-xl">30</span> <span class="text-2xl">/</span> <span>100</span></div>
            </div>
            <div class="w-100 bg-dark border-radius-5 align-self-center"
                 style="height: 5px;margin-bottom: 2px;width: 100%">
            </div>
        </div>
        <div class="d-flex flex-column bg-white text-white border-dark border-radius-5"
             style="width: 250px;height: 180px">
            <div class="d-flex flex-column flex-center gap-0-5 h-100">
                <div class="font-bold text-xl">Completed Donations</div>
                <div class="single-chart">
                    <svg viewBox="0 0 36 36" class="circular-chart green">
                        <path class="circle-bg"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <path class="circle"
                              stroke-dasharray="40, 100"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <text x="18" y="20.35" class="percentage">60%</text>
                    </svg>
                </div>
                <div><span class="font-extraBold text-success text-xl">60</span> / <span>100</span></div>
            </div>
            <div class="w-100 bg-green-6 border-radius-5 align-self-center"
                 style="height: 5px;margin-bottom: 2px;width: 100%">

            </div>
        </div>
        <div class="d-flex flex-column bg-white text-white border-dark border-radius-5"
             style="width: 250px;height: 180px">
            <div class="d-flex flex-column flex-center gap-0-5 h-100">
                <div class="font-bold text-xl">Aborted Donations</div>
                <div class="single-chart">
                    <svg viewBox="0 0 36 36" class="circular-chart primary">
                        <path class="circle-bg"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <path class="circle"
                              stroke-dasharray="40, 100"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <text x="18" y="20.35" class="percentage">60%</text>
                    </svg>
                </div>
                <div><span class="font-extraBold text-primary text-xl">60</span> / <span>100</span></div>
            </div>
            <div class="w-100 bg-primary border-radius-5 align-self-center"
                 style="height: 5px;margin-bottom: 2px;width: 100%">

            </div>
        </div>
        <div class="d-flex flex-column bg-white text-white border-dark border-radius-5"
             style="width: 250px;height: 180px">
            <div class="d-flex flex-column flex-center gap-0-5 h-100">
                <div class="font-bold text-xl"> Ongoing Blood Retrieval </div>
                <div class="single-chart">
                    <svg viewBox="0 0 36 36" class="circular-chart yellow">
                        <path class="circle-bg"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <path class="circle"
                              stroke-dasharray="40, 100"
                              d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <text x="18" y="20.35" class="percentage">60%</text>
                    </svg>
                </div>
                <div><span class="font-extraBold text-yellow-8 text-xl">60</span> / <span>100</span></div>
            </div>
            <div class="w-100 bg-warning border-radius-5 align-self-center"
                 style="height: 5px;margin-bottom: 2px;width: 100%">

            </div>
        </div>
    </div>
    <div class="d-flex align-items-start w-100 gap-2 justify-content-center">
        <div class="d-flex gap-2 align-items-start w-100 mt-2 gap-2 justify-content-center">
            <div class="d-flex flex-center w-40">
                <canvas id="myChart" width="400" height="400" style="max-width: 400px;max-height: 400px"></canvas>
            </div>
            <div class="d-flex w-40 flex-center">
                <canvas id="myChart2" width="400" height="400" style="max-width: 400px;max-height: 400px"></canvas>
            </div>
        </div>

        <div class="d-flex w-40 flex-column">
            <div class="d-flex text-center bg-dark py-1 px-2 text-white">
                Campaign Donor Queue
            </div>
            <div class="flex-column d-flex overflow-y-overlay" style="max-height: 50vh">
                <table class="">
                    <thead class="sticky top-0">
                        <tr>
                            <th class="text-center">No</th>
                            <th class="text-center">Name</th>
                            <th class="text-center">NIC</th>
                            <th class="text-center">Stage</th>
                            <th class="text-center">Status</th>
                            <th class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    <?php
                    /** @var CampaignDonorQueue[] $DonorQueue */

                    use App\model\Campaigns\CampaignDonorQueue;

                    if (isset($DonorQueue)):
                    $i = 1;
                        foreach ($DonorQueue as $DonorQueueItem):
                            $Donor = $DonorQueueItem->getDonor();
                            ?>
                            <tr>
                                <td class="text-center"><?=$i++?></td>
                                <td class="text-center"><?=$DonorQueueItem->getDonorName()?></td>
                                <td class="text-center"><?=$Donor->getNIC()?></td>
                                <td class="text-center"><?=$DonorQueueItem->getQueueState()?></td>
                                <td class="text-center"><?=$DonorQueueItem->getDonor_Status()!==CampaignDonorQueue::STAGE_4 ? '<span class="bg-yellow-9 text-white px-1 border-radius-10 py-0-5 d-flex fle-center">Waiting' :'<span class="green-d-flex fle-center">Completed</span>'?></td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-primary" onclick="ViewDonor('<?=$Donor->getNIC()?>')">View</button>
                                </td>
                            </tr>
                        <?php
                        endforeach;
                        else:
                    ?>
                        <tr>
                            <td colspan="6" class="text-center">No Donors in Queue</td>
                        </tr>
                    <?php
                    endif;
                    ?>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const ViewDonor = (nic)=>{
        console.log(nic)
        const url = "/mofficer/mngDonors/find"
        const data = new FormData();
        data.append('nic',nic);
        data.append('format','json');
        fetch(url,{
            method:'POST',
            body:data
        }).then(response=>response.json()).then(data=>{
            if (data.status){
                const donor = data.donor;
                OpenDialogBox({
                    id:'viewDonor',
                    title:'View Donor',
                    titleClass:'text-white bg-dark',
                    content: `
                        <div class="d-flex flex-column">
                            <div class="d-flex flex-column flex-center gap-1">
                                <div class="d-flex flex-column gap-1 w-100">
                                    <div class="font-bold bg-dark px-2 py-1 text-white">Personal Details</div>
                                    <div class="d-flex justify-content-center gap-1">
                                        <div class="d-flex flex-column gap-0-5 w-50">
                                            <div class="d-flex gap-1">
                                                <div class="font-bold">Full Name</div>
                                                <div class="font-thin">${donor.name}</div>
                                            </div>
                                            <div class="d-flex gap-1">
                                                <div class="font-bold">Age</div>
                                                <div class="font-thin">${donor.age}</div>
                                            </div>
                                            <div class="d-flex gap-1">
                                                <div class="font-bold">Address</div>
                                                <div class="font-thin">${donor.address}</div>
                                            </div>
                                            <div class="d-flex gap-1">
                                                <div class="font-bold">Contact No</div>
                                                <div class="font-thin">${donor.contactNo}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `,
                    showSuccessButton:false,
                    cancelBtnText:'Close',
                })
            }
        }).catch(error=>{
            console.log(error);
        })

    }
    const LoadChart = ()=>{
        const ctx = document.getElementById('myChart').getContext('2d');
        const Tasks = ['Health Checkup','Blood Checkup','Blood Retrieval','Blood Stored'];
        const colors = [
            "rgba(255, 0, 0, 1)",       // Red
            "rgba(220, 20, 60, 1)",     // Crimson
            "rgba(178, 34, 34, 1)",     // Fire Brick
            "rgba(165, 42, 42, 1)",     // Brown
            "rgba(139, 0, 0, 1)",       // Dark Red
            "rgba(128, 0, 0, 1)",       // Maroon
            "rgba(255, 0, 0, 0.8)",     // Red with alpha
            "rgba(220, 20, 60, 0.8)",   // Crimson with alpha
            "rgba(178, 34, 34, 0.8)",   // Fire Brick with alpha
            "rgba(165, 42, 42, 0.8)",   // Brown with alpha
            "rgba(139, 0, 0, 0.8)",     // Dark Red with alpha
            "rgba(128, 0, 0, 0.8)"      // Maroon with alpha
        ];
    //     Dummy Data
        const Data = [12, 19, 3, 5];
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Tasks,
                datasets: [{
                    label: 'Tasks',
                    data: Data,
                    backgroundColor: colors,
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(75, 192, 192, 1)',

                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
        const ctx2 = document.getElementById('myChart2').getContext('2d');
        const myChart2 = new Chart(ctx2, {
            type: 'doughnut',
            data: {
                labels: Tasks,
                datasets: [{
                    label: 'Tasks',
                    data: Data,
                    backgroundColor: colors,
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(75, 192, 192, 1)',

                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
    }
    LoadChart();


</script>
